<?xml version="1.0" encoding="UTF-8"?>
<STEP-ProductInformation ContextID="Context1" WorkspaceID="Main" UseContextLocale="false">
    <BusinessRules>
        <BusinessRule ID="SealChangePackage" Scope="Global" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
/** @type{ChangePackageHome} */
var cpHome = manager.getHome(com.stibo.core.domain.changepackage.ChangePackageHome)
var cp = cpHome.getChangePackageByID("ChangedItems")

removeDeletedItems(cp)

if (!isOpen(cp)) {
	log.info("AddToChangePackage Reopen")
	cp.reOpen()
}

cp.sealPackage("AutoSeal")

/**
* 
* @param {ChangePackage} pCP 
* @returns {boolean}
*/
function isOpen(pCP) {
	var state = pCP.getValue("ChangePackageState").getSimpleValue()
	logger.info("AddToChangePackage state = " + state)
	if ("Change Package (Sealed)".equals(state)) {
		logger.info("isOpen(" + pCP.getName() + " false")
		return false
	}
	logger.info("isOpen(" + pCP.getName() + " true")
	return true;
}

/**
 * 
 * @param {ChangePackage} pCP 
 */
function removeDeletedItems(pCP) {
	var allItems = pCP.getPrimaryItems();
	allItems.toArray().forEach(function (item) {
		if (item != null) {
			var n = pCP.getManager().getNodeFromURL(item);
			if (n == null) {
				logger.info("AddToChangePackage.removeDeletedItems item in package is deleted " + item)
				pCP.removeItem(item)
			}
		}
	})
}
  </javaScript>
</config> -->
            <SetupGroupLink SetupGroupID="TrackChanges"></SetupGroupLink>
            <Name QualifierID="Qualifier root">Seal ChangePackage</Name>
            <OnApprove ApproveSetup="Never"></OnApprove>
            <Configuration>H4sIAAAAAAAAALVV227bMAx9jr9C9UNhZ5i9vQ3IpU3SFuvQdkGTbo+FaiuuNllyJTloVuTfR13sxOgFBYYBCWAdkofkIW1VrC4ov8VVxShRt3R1mwm+osVoePRYMrQmUlHBR+Hn5FOICM9ETnkxCm+WZx+/hEfjYDitFeVEqeuakRTOCoj0uHK0/8A1DhBqgbmlQ/t2B52fjMJveI0XmaSVbuyTTEOin1TfTynPVWi4gG2OJS6JhjIcsA8hw+S80XJTkVH4C2gThnmRLLSEQsPxIdODTieHD7XQA2jHPex6cmfbmHs8Oiz0IDAEJsclruwZoQZBoJSWONNQhou4xBwXRBrjzNt8lgmjWHmv0nl5S9vNjGHVuPCaMfeUtkWk+1UM0zbuFV1OpRTyEoSFXP9bnwuRYUb/4DtGfMYlKSuGNZnWPIcde2fNu614veC030fHGoxPs3vAyRxnvyHhV1GSLeqnwRpLlFXmiEbIS50URBskykSZKE3vRJIJSZJclJjyJLNElSNKntHGnhP4HLGh63hNN+cnkRPF4fm5JqVySBwEkpRiTU4Ig06dKcoqwOkKRQdUfa8IN0CMnoIeE0VC+Up4vkmeL0UnGbomAgIa8l5WJZJYijjYBgEcFcHMOzcstRYLQNuKQMWgj+B3XJkJoK6YW1TN5tYqia4lV+jpTghGMN8GIPGq5vZlRb50cLalG5mUhqmDUoAZmX5gVpOOND7Fwvj5cozjgsLCEOceWxXM3N4WosnlN/WDAyDa6LqfEzURkRGB5LEzJuShxkxFLsy28EJi32SbxHd2BXsbxXD2hhUwkXYoPSecQ4Pe9qWO3kmsZb3j9bQGG5hpmzkiGCR6e5Jof2ovbOP+BDFjFtwNcS5pieXGucaDoNe4JFpMpMSbKE5WQp7i7D5qs0QUPJymZhzmhA5GyHzZHGqT8V0W//GM7DpciZycSVHeXF84ooGJMEQQ0WF516okz3tGtiK4oPx7D8uMcmffLZRNbbOYIh2JiY5aA0zW/Lf23Xv2hdsD7P01TLu3I9yfafcC9XfxX8/DCZXjBwAA</Configuration>
            <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
        </BusinessRule>
    </BusinessRules>
</STEP-ProductInformation>