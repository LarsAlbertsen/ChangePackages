<?xml version="1.0" encoding="UTF-8"?>
<STEP-ProductInformation ContextID="Context1" WorkspaceID="Main" UseContextLocale="false">
    <BusinessRules>
        <BusinessRule ID="UpdateChangePackage" Scope="Global" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
logger.info("AddToChangePackage user=" + node.getManager().getCurrentUser().getID() + "node=" + node)

if (node != null) {
	/** @type{ChangePackageHome} */
	var cpHome = manager.getHome(com.stibo.core.domain.changepackage.ChangePackageHome)
	var cp = cpHome.getChangePackageByID("ChangedItems")

	if (!isOpen(cp)) {
		log.info("AddToChangePackage reOpen")
		cp.reOpen()
	}

	if (node instanceof com.stibo.core.domain.impl.businessrule.RevisedBusinessActionImpl) {
		// maybe remove all of RevisableNode?
		log.info("AddToChangePackage removing BR");
		cp.removeItem(node);
		return;
	}
	if (node instanceof com.stibo.core.domain.AttributeGroup ||
		node instanceof com.stibo.core.domain.setupgroup.SetupGroup) {
		logger.info("AddToChangePackage addHierarchy " + node.getClass().getName())
		cp.addHierarchy(node)
	}
	else {
		logger.info("AddToChangePackage addItem " + node.getClass().getName())
		cp.addItem(node)
	}
}

/**
 * 
 * @param {ChangePackage} pCP 
 * @returns {boolean}
 */
function isOpen(pCP) {
	var state = pCP.getValue("ChangePackageState").getSimpleValue()
	logger.info("AddToChangePackage state = " + state)
	if ("Change Package (Sealed)".equals(state)) {
		//logger.info("isOpen(" + pCP.getName() + " false")
		return false
	}
	//logger.info("isOpen(" + pCP.getName() + " true")
	return true;
}
  </javaScript>
</config> -->
            <SetupGroupLink SetupGroupID="TrackChanges"></SetupGroupLink>
            <Name QualifierID="Qualifier root">Update ChangePackage</Name>
            <OnApprove ApproveSetup="Never"></OnApprove>
            <Configuration>H4sIAAAAAAAAALVW227cNhB9Xn3FZB8MyUWl9q3Aeu14N23jIk4Mr9M+GlxpVmZKkQxJLeo6/vcOL9oL3GBtpH0QIA6H58yZC0Et+pbLW6a14Ghv+eq2VnLF2+nJ2V+dgDUay5Wcjn8sfxgDylo1XLbT8cebX77/aXx2mp3MesslWnvdC6xobQnIneoI+w1YpxnAxnAV4GB3P5ou3kzHv7E1W9SGazfsn9eOiP7g7m7GZWPHHovQrphhHToKIxp2TeCRojfc3Gucjj8RbCmYbMuFMxTo+PRIuMmekqPPvXITkhN/tpriOgiLv2dHrZtkHsBzXDId1gCDBShTzrDaURjxxLw3BqX7sPyEtfMu8+SRuM4FZzb5StVgMm8EzQWzm/1eiPhXHeR9p9oWzQFCEZz+K8pLJtlhzi56vYTUU1a7CT+pNue+0gI/G6PMJfUQcf3frfBO1Uzwv9lSYGK8wU4L5nDWy4bG6Zkxbwfg6wHHipVcrlQe4zhvmhs1vyMnvGL1n8QOvUWTAobvwHdV2aJL5ckLv0ht+dEOhos3eUHO20bcByiyjK8g97/wagq+QgU8ZKPq+BheOwr2YS+Et6rDRziustGaGai1X8MUUu09n7fktepK6/hSlbUyWDaqY1yWdUDSEal8glsMoAQYkYOgXbfZPclJ8xfszYXDzkYLSRl5La+4/aBR5rUugpQR5fZAYg36EwPMaFTrMppyWj0m3JAjLq1jska1gn8XyalDymW66AxdhOU1rrnFZv/yuyC3GF1VUfrulz6ITq0RmBBA6OGUb733RHv2TBUEQN0Es+skZTJo8cg+VUFEMBt0vZETL+8F6s4d9euyd/irUb2GL18I6XknLfHp1p8qF/43AGzqc7j3WdO85WiYqe/u4ckMhFsmNvx7mry8SFXcPRW1B8EoLL6I2ufuRazbZHtCaiEaqAyOwX+vtb8eYH+yHkHPr+J2LI2Fh6VSApl8zPzErXoZOgdSe5N7SJ+fGcq983NINh/M70z0uDcniWTh/VJveMeF71aM7hTos7IxcG2yEQxF7KJdThhO5AtkApsibpb4uWfC5vHYMANPqZPMDU3SFhO9udFgRVi4ndyYu2gNpf4GaGf6LXIC9raJr+eTa3/HEN4vJ9X+64jeT9X+Ayq9xf4B5kXvAOMJAAA=</Configuration>
            <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
        </BusinessRule>
    </BusinessRules>
</STEP-ProductInformation>