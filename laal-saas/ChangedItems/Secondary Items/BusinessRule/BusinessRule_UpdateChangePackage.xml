<?xml version="1.0" encoding="UTF-8"?>
<STEP-ProductInformation ContextID="Context1" WorkspaceID="Main" UseContextLocale="false">
    <BusinessRules>
        <BusinessRule ID="UpdateChangePackage" Scope="Global" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
logger.info("AddToChangePackage " + node)

if (node != null) {
	/** @type{ChangePackageHome} */
	var cpHome = manager.getHome(com.stibo.core.domain.changepackage.ChangePackageHome)
	var cp = cpHome.getChangePackageByID("ChangedItems")

	if (!isOpen(cp)) {
		log.info("AddToChangePackage reOpen")
		cp.reOpen()
	}

	if (node instanceof com.stibo.core.domain.impl.businessrule.RevisedBusinessActionImpl) {
		// maybe remove all of RevisableNode?
		log.info("AddToChangePackage removing BR");
		cp.removeItem(node);
		return;
	}
	if (node instanceof com.stibo.core.domain.AttributeGroup ||
		node instanceof com.stibo.core.domain.setupgroup.SetupGroup) {
		logger.info("AddToChangePackage addHierarchy "+node.getClass().getName())
		cp.addHierarchy(node)
	}
	else {
		logger.info("AddToChangePackage addItem "+node.getClass().getName())
		cp.addItem(node)
	}
}

/**
 * 
 * @param {ChangePackage} pCP 
 * @returns {boolean}
 */
function isOpen(pCP) {
	var state = pCP.getValue("ChangePackageState").getSimpleValue()
	logger.info("AddToChangePackage state = " + state)
	if ("Change Package (Sealed)".equals(state)) {
		//logger.info("isOpen(" + pCP.getName() + " false")
		return false
	}
	//logger.info("isOpen(" + pCP.getName() + " true")
	return true;
}
  </javaScript>
</config> -->
            <SetupGroupLink SetupGroupID="TrackChanges"></SetupGroupLink>
            <Name QualifierID="Qualifier root">Update ChangePackage</Name>
            <OnApprove ApproveSetup="Never"></OnApprove>
            <Configuration>H4sIAAAAAAAAALVW227bOBB9tr6C9UMgp6jUvi3gOBe7tyyaNIizu48BLY0VthTJkpSx2ST/vjMkfUO2cIJsHwSQw5lz5gxnCBnZNUJdc2OkAHct5teVVnPRjA6O/m4lW4B1QqtR/13xts9AVboWqhn1/7j6+Oa3/tFhdjDunFDg3GUnocS9QyB/aCLsC7AOM8ZWhosAxzbPo+n0/aj/O1/waWWF8cvzk8oj0V/C34yFql2fsBDtglvegsc0omHTxAgperOrWwOj/jeELSRXTTH1FhPtH+5JP9xSsvej036IcuJirSnug7C4PNpr/DAjAOI44ybsGVtaGFbKW155TCNGTDprQfmvs29QeXKZJI/EdSIFd8lX6RqSeSVoIrlbnXdSxlW5k/eLbhqwOwhlcPq/KM+44rs52+j1HFKiLDcLflCu4n7SAh+s1fYMewi5fnUrfNEVl+IfPpOQGK+gNZJ7GHeqxnF6Ys7rAfh5wvHGCqHmOo95nNT1lZ7coBNc8Oo7srOU+2tGDTXIMjFnOS3ZqxGj2g7YXdYr9/fZsUeau63gz7qFB7ZfZr0Ft6wytGcjlm6taMCTJa90WzgvZrqotIWi1i0XqqgCkolIxSPcwRIUASMy4W25jW9P3ydh0V6femhdtKCUHml5JdxXAyqvzCBI6WFVdpTEAkUsYXq9yhTRlOPuIeGGGgnlPFcV6Dn7b5EC77aYpSfK4hNWXMJCOKi3n61TdIvZlSWW73ZGSbR6AYxLyRA9RFHTnCPt0RNVIAD2ARtfJinDpRZCplIFEcFswXdWDUneM9SdeOy0Wefhk9WdYff3iPS0SId8pqGoYkrLALC6n91dy+v6swDLbXVzm1r4NTGHHqHXIR/Q8hwnJh+kO9yMicqDXJAOnkVMlXsG57rQRIftg8OUsX1G37GhoWbbU/XAzOQiHsdrcexuprUErh4ymrZ5p0LXsNTa6B5KR/OCdfc0g2ijZP7ksoOtGUkkU/JLfUGOU+pUiO6Y6JNqseRaPSHBMIgdtMnJlhH5FLiEehAPC/jRcenyGLbs/8fUSeaKJmmLhcZ9OpgjFqynNtYuWsNFvwDa226NnIDJNqT7fPRYbxjCX8dBuf1Pg3895fZvT/qD+hc8Z2ovmQkAAA==</Configuration>
            <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
        </BusinessRule>
    </BusinessRules>
</STEP-ProductInformation>