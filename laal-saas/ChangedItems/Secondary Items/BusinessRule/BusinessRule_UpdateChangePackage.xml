<?xml version="1.0" encoding="UTF-8"?>
<STEP-ProductInformation ContextID="Context1" WorkspaceID="Main" UseContextLocale="false">
    <BusinessRules>
        <BusinessRule ID="UpdateChangePackage" Scope="Global" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
logger.info("AddToChangePackage user=" + node.getManager().getCurrentUser().getID() + " node=" + node)

if (node != null) {
	/** @type{ChangePackageHome} */
	var cpHome = manager.getHome(com.stibo.core.domain.changepackage.ChangePackageHome)
	var cpID = "ChangedItems-"+node.getManager().getCurrentUser().getID()
	var cp = cpHome.getChangePackageByID(cpID)

	if (cp==null) {
		cp = cpHome.createChangePackage("AutoUpdateChangePackages", cpID)
		
		cp.setName(cpID);
		cp.setSimpleValue(manager.getAttributeHome().getAttributeByID("GITBranch"), cpID)
	}

	if (!isOpen(cp)) {
		log.info("AddToChangePackage reOpen")
		cp.reOpen()
	}

	if (node instanceof com.stibo.core.domain.impl.businessrule.RevisedBusinessActionImpl) {
		// maybe remove all of RevisableNode?
		log.info("AddToChangePackage removing BR");
		cp.removeItem(node);
		return;
	}
	if (node instanceof com.stibo.core.domain.AttributeGroup ||
		node instanceof com.stibo.core.domain.setupgroup.SetupGroup) {
		logger.info("AddToChangePackage addHierarchy " + node.getClass().getName())
		cp.addHierarchy(node)
	}
	else {
		logger.info("AddToChangePackage addItem " + node.getClass().getName())
		cp.addItem(node)
	}
}

/**
 * 
 * @param {ChangePackage} pCP 
 * @returns {boolean}
 */
function isOpen(pCP) {
	var state = pCP.getValue("ChangePackageState").getSimpleValue()
	logger.info("AddToChangePackage state = " + state)
	if ("Change Package (Sealed)".equals(state)) {
		//logger.info("isOpen(" + pCP.getName() + " false")
		return false
	}
	//logger.info("isOpen(" + pCP.getName() + " true")
	return true;
}
  </javaScript>
</config> -->
            <SetupGroupLink SetupGroupID="TrackChanges"></SetupGroupLink>
            <Name QualifierID="Qualifier root">Update ChangePackage</Name>
            <OnApprove ApproveSetup="Never"></OnApprove>
            <Configuration>H4sIAAAAAAAAALVW32/bNhB+tv8K1g+Bla7S9jbAUdLY2VoXTRvEzvYY0NLZYUeTKkkZy9L8770jKVluVthBtwcD4vHu++63Wcl6JdQtryopwN6K5W2h1VKs8pOzv9eSbcBYoVU++CX9ecBAFboUapUPbua/v/p1cHbaPxnXViiw9rqWkOHZIpA7rQLsD2Cd9hlrBVcejnXvg2h6kQ/e8Q2fFUZUrrk/LxwS/Snc3Vio0g4IC9GuuOFrcOhGEHRFjJCCNpvfV5APPiFsKrlapTNn0NHB6ZF0o51Ijj7X2o0wnPCxjSmcfWDh8+xo5UZ9AiCOS175M2ONhGGmnOGFQzeCxaQ2BpT7uPgEhSOVSdSIXOdScBt1lS4hituAJpLb9r6WMnxle3nf69UKzB5C6ZX+K8pLrvh+znXQeg4pUWbdhJ9krd13WuA3Y7S5xB5Crv+7Fd7rgkvxD19IiIxzWFeSOxjXqsRxOtDn7QB83+FQsVSopR4GP87Lcq4nd6gEV7z4C9lZbcFEh9lLRl2VrsDF8gwTOsS2vLGNYHoxTFA5WpHNLkLS74slG9Ine5EzKlHCHvq97PiYvXbo7cOOD2/1Gh7ZcdbvbbhhRUVnlrNYfCIkybDQ69Q6sdBpoQ2kpV5zodLCI1UBKX2CmzSg0wuEjGPmlcqpg7V9FUQvDw+8AUS44KrX7PKO71GPGDEPPUpEUeV5m4Re17QwgKXfsW5KVTt9U5Xf3tpw+xML+L2eB0wtuA+cckTSUSubCewt+IPLGoaddJ477JBF7XyGQmStyDsfSN5M52PDVXEXjklL+hjjeiHsxwoUsiYhNOy4Pe1mgCwiYPAziIYdXN84QlmH5KCX7N8rT7Gli7j+Df49pNewERbK3b+EKaoF77IMe+p+QU6s9QYYl5IhureigfyAtGcHRoEAOGNsfB1DGTWxEDJ1lg/Ciw242qgRhfeM6NqCvDG6rtiXL4h0mCXWva5WZJXO6NMDtPXZvxF4Wb4VYLgp7u7Zk83gd2/oGd9xSaxi1yrE7gMGaeFZ1JS7Z7Fuk02E2EK4ZfrsmNHvdUVLk+2um0dWTa7CdSiNZQ8LrSVw9dinNbSsle8cFtsb1X36aO4x946WE8rImTBa3bUSSWakF3uDFLuTiI4elI2Gq82GFyShi7qcrLEYzoBLKJNwmcLnmks7DGbNDDyljmG2NDG2kOjtnl8iFmwnN+QuSH2pfwDamXqLHIFJNqJ6Pvkz7Aj8q+4k230z4qsy231WxhfqV3pcxHn5CgAA</Configuration>
            <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
        </BusinessRule>
    </BusinessRules>
</STEP-ProductInformation>